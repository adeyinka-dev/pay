{% extends "company/adminbase.html" %}
{% load humanize %}
{% block content %}
<main class="u-min-h-screen">
    <div class="mx-auto max-w-screen-2xl p-4 md:p-6 2xl:p-6">
      <!-- Breadcrumb Start -->
      <div
        class="mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"
      >
            <nav>
                <ol class="flex items-center gap-7">
                <li>
                    {% if payslip.status == "Pending" %}
                    <p class="inline-flex rounded-full bg-black py-1 px-3 text-sm text-white hover:bg-opacity-90">Pending</p>
                    {% elif payslip.status == "Paid" %}
                    <p class="inline-flex rounded-full bg-primary py-1 px-3 text-sm text-white hover:bg-opacity-90">Paid</p>
                    {% else %}
                    <p class="inline-flex rounded-full bg-danger py-1 px-3 text-sm text-white hover:bg-opacity-90">Action Required</p>
                    {% endif %}
                </li>
                </ol>
            </nav>
            {% if error_message %}
                <div class="p-4 sm:p-4 xl:p-4 notificationDiv" id="errorDiv">
                    <div class="rounded-lg border border-[#F5C5BB] bg-[#FCEDEA] py-2 pl-2 pr-5.5 shadow-2">
                      <div class="flex items-center justify-between">
                        <div class="flex flex-grow items-center gap-2">
                          <div
                            class="flex h-15 w-full max-w-15 items-center justify-center rounded-md bg-[#EA4E2C]"
                          >
                            <svg
                              width="32"
                              height="32"
                              viewBox="0 0 32 32"
                              fill="none"
                              xmlns="http://www.w3.org/2000/svg"
                            >
                              <path
                                fill-rule="evenodd"
                                clip-rule="evenodd"
                                d="M14.2021 3.33462C14.7513 3.02546 15.3708 2.86304 16.001 2.86304C16.6312 2.86304 17.2507 3.02546 17.7999 3.33462C18.349 3.64379 18.8092 4.08926 19.136 4.62807L19.1389 4.63282L30.4322 23.4862L30.4403 23.5C30.7605 24.0544 30.9299 24.683 30.9317 25.3233C30.9335 25.9635 30.7676 26.593 30.4505 27.1493C30.1335 27.7055 29.6763 28.169 29.1245 28.4937C28.5727 28.8184 27.9455 28.9929 27.3053 29L27.2943 29.0001L4.69668 29C4.05647 28.993 3.42928 28.8184 2.87748 28.4937C2.32568 28.169 1.86851 27.7055 1.55146 27.1493C1.23441 26.593 1.06853 25.9635 1.07033 25.3233C1.07212 24.683 1.24152 24.0544 1.56168 23.5L1.5698 23.4862L12.8631 4.63282L13.721 5.1467L12.866 4.62807C13.1928 4.08926 13.653 3.64379 14.2021 3.33462ZM14.5773 5.6632C14.5769 5.66391 14.5764 5.66462 14.576 5.66532L3.29013 24.5062C3.14689 24.7567 3.07113 25.0402 3.07032 25.3289C3.0695 25.6199 3.1449 25.906 3.28902 26.1589C3.43313 26.4117 3.64093 26.6224 3.89175 26.77C4.14117 26.9167 4.42447 26.996 4.71376 27H27.2882C27.5775 26.996 27.8608 26.9167 28.1103 26.77C28.3611 26.6224 28.5689 26.4117 28.713 26.1589C28.8571 25.906 28.9325 25.6199 28.9317 25.3289C28.9309 25.0402 28.8551 24.7567 28.7119 24.5062L17.426 5.66532C17.4256 5.66462 17.4251 5.66391 17.4247 5.6632C17.2762 5.41924 17.0676 5.21752 16.8187 5.07739C16.5691 4.93686 16.2875 4.86304 16.001 4.86304C15.7146 4.86304 15.4329 4.93686 15.1833 5.07739C14.9345 5.21752 14.7258 5.41924 14.5773 5.6632Z"
                                fill="white"
                              />
                              <path
                                fill-rule="evenodd"
                                clip-rule="evenodd"
                                d="M16 11C16.5523 11 17 11.4477 17 12V17.3333C17 17.8856 16.5523 18.3333 16 18.3333C15.4477 18.3333 15 17.8856 15 17.3333V12C15 11.4477 15.4477 11 16 11Z"
                                fill="white"
                              />
                              <path
                                fill-rule="evenodd"
                                clip-rule="evenodd"
                                d="M15 22.6666C15 22.1143 15.4477 21.6666 16 21.6666H16.0133C16.5656 21.6666 17.0133 22.1143 17.0133 22.6666C17.0133 23.2189 16.5656 23.6666 16.0133 23.6666H16C15.4477 23.6666 15 23.2189 15 22.6666Z"
                                fill="white"
                              />
                            </svg>
                          </div>
                          <div>
                            <p class="text-sm">
                                {{ error_message }}
                            </p>
                          </div>
                        </div>
  
                        <div>
                          <a
                            class="flex h-5 w-5 items-center justify-center rounded-md bg-white"
                            id="closeButton"
                          >
                            <svg
                              width="10"
                              height="10"
                              viewBox="0 0 14 14"
                              fill="none"
                              xmlns="http://www.w3.org/2000/svg"
                            >
                              <path
                                fill-rule="evenodd"
                                clip-rule="evenodd"
                                d="M0.854423 0.85186C1.2124 0.493879 1.79281 0.493879 2.15079 0.85186L7.0026 5.70368L11.8544 0.85186C12.2124 0.493879 12.7928 0.493879 13.1508 0.85186C13.5088 1.20984 13.5088 1.79024 13.1508 2.14822L8.29897 7.00004L13.1508 11.8519C13.5088 12.2098 13.5088 12.7902 13.1508 13.1482C12.7928 13.5062 12.2124 13.5062 11.8544 13.1482L7.0026 8.2964L2.15079 13.1482C1.79281 13.5062 1.2124 13.5062 0.854423 13.1482C0.496442 12.7902 0.496442 12.2098 0.854423 11.8519L5.70624 7.00004L0.854423 2.14822C0.496442 1.79024 0.496442 1.20984 0.854423 0.85186Z"
                                fill="#637381"
                              />
                            </svg>
                        </a>
                        </div>
                      </div>
                    </div>
                </div>
                {% endif %}
            <div class="flex items-center justify-between">
    
            <h2 class="text-danger font-semibold mr-4">Change Status:</h2>
            <form method="post" class="flex items-center">
                

                {% csrf_token %}
                
                <div class="mr-4">
                    <select name="{{ form.status.name }}" id="{{ form.status.id_for_label }}" class="py-1 px-3 border border-gray rounded-lg focus:border-danger">
                        {% for choice in form.status.field.choices %}
                            <option value="{{ choice.0 }}" {% if choice.0 == form.status.value %}selected{% endif %}>{{ choice.1 }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <input type="submit" value="Update" class="flex items-center justify-center rounded-lg border border-primary py-1 px-3 text-center font-medium text-primary hover:opacity-90">
            </form>
            </div>

      </div>
      <!-- Breadcrumb End -->

      <!-- ====== Invoice Section Start -->
      <div
        class="rounded-lg border border-stroke bg-white p-4 shadow-default md:p-6 xl:p-9"
      >
        <div
          class="flex flex-col-reverse gap-5 xl:flex-row xl:justify-between"
        >
          <div class="flex flex-col gap-4 sm:flex-row xl:gap-9">
            <div>
              <h4
                class="mb-4 text-xl font-semibold text-primary "
              >
              {{ payslip.employee.first_name|upper }} {{ payslip.employee.last_name|upper }}
              </h4>
              <span class="mt-2 mb-2 block"
                ><span class="font-medium">Period: </span> {{ payslip.get_month_display }} {{ payslip.year }}</span>
              <a href="#" class="block"
                ><span class="font-medium">Email:</span>
                {{ payslip.employee.username }}</a
              >
              <span class="mt-2 block"
                ><span class="font-medium">Address: </span>{{ payslip.employee.address }}</span>
            </div>
          </div>
          <h3 class="text-2lg font-medium text-black">
            REF  - {{ payslip.get_payslip_id }}
          </h3>
        </div>

        <div
          class="my-10 rounded-lg border border-stroke p-5"
        >
          <div class="items-center sm:flex">
            <div class="w-full items-center justify-between md:flex">
              <div class="mb-3 md:mb-0">
                <a
                  href="#"
                  class="inline-block font-medium text-black hover:text-primary"
                >
                  Total Earnings
                </a>
                <p class="flex text-sm font-medium text-primary">
                  <span class="mr-5"> Salary: ₦{{ payslip.employee.basic_salary|intcomma }} </span>
                  <span class="mr-5"> Bonus: ₦{{ payslip.bonuses|intcomma }} </span>
                </p>
              </div>
              <div class="flex items-center md:justify-end">

                <p class="mr-5 font-medium text-primary">
                    <span>₦{{ payslip.employee.basic_salary|default:"0"|add:payslip.bonuses|default:"0"|intcomma }}</span>
                </p>
              </div>
            </div>
          </div>
        </div>
        <div
          class="my-10 rounded-lg border border-stroke p-5"
        >
          <div class="items-center sm:flex">
            <div class="w-full items-center justify-between md:flex">
              <div class="mb-3 md:mb-0">
                <a
                  href="#"
                  class="inline-block font-medium text-black hover:text-primary"
                >
                  Deductions
                </a>
                <p class="flex text-sm font-medium text-danger">
                    {% for deduction in deductions %}
                    <span class="mr-5"> {{ deduction.get_type_display }}: ₦{{ deduction.amount|intcomma }} </span>
                    {% endfor %}
                </p>
              </div>
              <div class="flex items-center md:justify-end">
                <p class="mr-5 font-medium text-black">
                  - ₦{{ payslip.total_deductions|intcomma }}
                </p>
              </div>
            </div>
          </div>
        </div>

        <div class="-mx-4 flex flex-wrap">
          <div class="w-full px-4 sm:w-1/2 xl:w-3/12">
            <div class="mb-6">
              <h4
                class="mb-2 text-xl font-medium text-primary"
              >
                Generated on
              </h4>
              <p class="font-medium">
                {{ payslip.generated_on|date:"M d, Y" }}  <br />
                {{ payslip.generated_on|date:"g:ia" }}
              </p>
            </div>
          </div>
          <div class="w-full px-4 sm:w-1/2 xl:w-3/12">
            <div class="mb-6">
              <h4
                class="mb-2 text-xl font-medium text-primary"
              >
                Paid To
              </h4>
              <p class="font-medium">
                Savings <br />
                {{ payslip.employee.bank }} - {{ payslip.employee.account_number }}
              </p>
            </div>
          </div>
          <div class="w-full px-4 xl:w-6/12">
            <div class="mr-10 text-right md:ml-auto">
              <div class="ml-auto sm:w-1/2">
                <p
                  class="mb-4 flex justify-between font-medium text-black"
                >
                  <span> Subtotal </span>
                  <span>₦{{ payslip.employee.basic_salary|default:"0"|add:payslip.bonuses|default:"0"|intcomma }}</span>
                </p>
                <p
                  class="mb-4 flex justify-between font-medium text-black"
                >
                  <span> Deductions (-) </span>
                  <span> ₦{{ payslip.total_deductions|intcomma }}</span>
                </p>
                <p
                  class="mb-4 mt-2 flex justify-between border-t border-stroke pt-6 font-semibold text-md text-black"
                >
                  <span> Net Pay </span>
                  <span> ₦{{ payslip.net_pay|intcomma }} </span>
                </p>
              </div>

              <div
                class="mt-10 flex flex-col justify-end gap-4 sm:flex-row"
              >
                <button
                  class="flex items-center justify-center rounded-lg border border-primary py-2.5 px-8 text-center font-medium text-primary hover:opacity-90"
                >
                  Download Payslip
                </button>
                <button
                  class="flex items-center justify-center rounded-lg bg-primary py-2.5 px-8 text-center font-medium text-white hover:bg-opacity-90"
                >
                  Send Payslip
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <script>
        document.getElementById('closeButton').addEventListener('click', function(e) {
             e.preventDefault();
            var errorDiv = document.getElementById('errorDiv');
            errorDiv.classList.add('hidden');
        });
    
      </script>
      <!-- ======Invoice Section End -->
    </div>
  </main>

{% endblock %}